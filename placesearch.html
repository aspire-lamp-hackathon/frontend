<!DOCTYPE html>
<head>
	<meta charset="utf-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/themes/smoothness/jquery-ui.css" rel="stylesheet" type="text/css" />
     <link rel="stylesheet" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true&libraries=places&language=en-US"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.0.3/angular.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.0.3/angular-resource.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script>
        angular.module('Otd', ['OtdDirectives']);

        /* Controllers */
        
       function calcRoute(params) {
		  var start = params.location;//lat: 13.112416, lng: 80.2716064};
		  var end = params.location2;//{lat: 12.9112936, lng: 79.9310303};
		  var request = {
			  origin:start,
			  destination:end,
			  travelMode: google.maps.TravelMode.DRIVING
		  };
		  directionsService.route(request, function(response, status) {
			if (status == google.maps.DirectionsStatus.OK) {
			  directionsDisplay.setDirections(response);
			}
		  });
		} 
		
	var directionsDisplay;
    var directionsService = new google.maps.DirectionsService();
    var map;
    function initialize()
    {
        directionsDisplay = new google.maps.DirectionsRenderer();
        var mapOptions =
                {
                    zoom: 9,
                    center: {lat: 13.112416, lng: 80.2716064},
                    mapTypeId: google.maps.MapTypeId.ROADMAP,
                };

        map = new google.maps.Map(document.getElementById('googleMap'), mapOptions);
        directionsDisplay.setMap(map);  
       /* var route.location = {"lat": 13.112416, "lng": 80.2716064};
        route.location2= {"lat": 12.9112936, "lng": 79.9310303}; 
        calcRoute(route);*/

    };
google.maps.event.addDomListener(window, 'load', initialize); 
        function SearchForm($scope){
            $scope.location = '';

            $scope.doSearch = function(){
                if($scope.location === ''){
                    alert('Directive did not update the location property in parent controller.');
                } else {
                    //alert('From. Location: ' + $scope.location +'TO. Location: ' + $scope.location2);
                    calcRoute($scope);
                    
                }
            };
        }

        /* Directives */
        var myapp = angular.module('OtdDirectives', []);
        
            myapp.directive('googlePlaces', function(){
                return {
                    restrict:'E',
                    //replace:true,
                    // transclude:true,
                    scope: {location:'=',location2:'='},
                    template: '<label for="google_places_ac1"> Pickup Point :</label><input class="google_places_ac" name="google_places_ac1" type="text" class="input-block-level"/>'+
                              '<label for="google_places_ac1">Drop Point :</label><input class="google_places_ac" name="google_places_ac2" type="text" class="input-block-level"/>',
                    link: function($scope, elm, attrs){
                        var autocomplete = new google.maps.places.Autocomplete($(".google_places_ac")[0], {});
                        google.maps.event.addListener(autocomplete, 'place_changed', function() {
                            var place = autocomplete.getPlace();
                            $scope.location = {'lat':place.geometry.location.lat(), 'lng':place.geometry.location.lng()};
                            $scope.$apply();
                        });
                        var autocomplete2 = new google.maps.places.Autocomplete($(".google_places_ac")[1], {});
                        google.maps.event.addListener(autocomplete2, 'place_changed', function() {
                            var place = autocomplete2.getPlace();
                            $scope.location2 = {'lat':place.geometry.location.lat(), 'lng':place.geometry.location.lng()};
                            $scope.$apply();
                        });
                    }
                }
            });
 
          myapp.directive('datepicker', function() {
			  return {
				require: 'ngModel',
				link: function(scope, el, attr, ngModel) {
				  $(el).datepicker({
					onSelect: function(dateText) {
					  scope.$apply(function() {
						ngModel.$setViewValue(dateText);
					  });
					}
				  });
				}
			  };
			});

            
    </script>
</head>
<body>
	
   <div id="content" class="container-fluid">
	   <header>
		<div class="logo"><img src="images/carpool2.jpg"></div>
		<hr>
	   </header>
	   <div class="row">
		<div ng-app="Otd" ng-controller="SearchForm">
			<div class="search-form col-lg-4 pull-left">
			<google-places location=location location2=location2></google-places>
			<label for="travel-date">Travel Date:</label>
			<input type="text" datepicker="" ng-model="startDate" ng-change="dateChanged(startDate)" name="travel-date" placeholder="Pick your date" />
			<button ng-click="doSearch()" class="btn btn-large btn-primary">Search</button>
		    </div>
		    <div class ="col-lg-8 pull-right gmap">
				<ion-pane>
				  <ion-header-bar class="bar-stable">
				  </ion-header-bar>
				  <ion-content>          
					  <div id="googleMap" name="googleMap"></div>                    
				  </ion-content>
				</ion-pane>
			</div>
		</div>
		</div>
</div>
</body>
</html>
